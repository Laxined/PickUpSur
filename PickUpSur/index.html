<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PickUpSur</title>
</head>
<style>
    body {
        font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
    }

     .mid {
        display: block;
        margin: 15%;
        margin-top: 0%;
        margin-bottom: 0%;
    }

    canvas {
     background-color: grey;
    }

    h1 {
     text-align: center;
      font-size: 350%;
    }

    h2 {
        text-align: center;
        font-size: 200%;
    }
</style>
<body onload="alert('To see Controls hold Q.')">
    <h2>Inventory Status: <span id="Inventory"></span></h2>
    <div class="mid">
    <canvas id="myCanvas" width="1500" height="900" style="border:5px solid black">
        Your browser does not support the canvas element.
    </canvas>
    </div>
</body>
<script>
      var canvas = document.getElementById("myCanvas");
      var ctx = canvas.getContext("2d");
      

      window.addEventListener('keydown', this.onKey, false);
      window.addEventListener('keyup', this.onKeyUp, false);

      let inventoryElement = document.getElementById("Inventory");

      let posX = 400;
      let posY = 400;
      let plSizeX = 50;
      let plSizeY = 50;
      let speedX = 0;
      let speedY = 0;

      let E = false;
      let EPush = false;

      let MaterialInInventory = false;
      let npcStatus = 0;
      let talk = 0;

      let Q = false;
      let QPush = false;

      let npc = {x: 600, y: 75, sx: 75, sy: 75, sk: "red", name: "Lucio"};


        let enemyList = [
            newEnemy(400, 600, 83, 50, false, Math.PI * 2 * Math.random(), "black", 5),
            newEnemy(400, 600, 83, 50, false, Math.PI * 2 * Math.random(), "black", 5),
            newEnemy(400, 750, 83, 50, false, Math.PI * 2 * Math.random(), "black", 5),
            newEnemy(400, 750, 83, 50, false, Math.PI * 2 * Math.random(), "black", 5),
        ]

        function newEnemy(x, y, szX, szY, fr, ang, sk, sp) {
            return {x: x, y: y, szX: szX, szY: szY, fr: fr, ang: ang, sk: sk, sp:sp}
        }

        let stillEnemyList = [
            newStillEnemy(0, 550, 83, 50, 2, "black"),
            newStillEnemy(500, 550, 83, 50, 2, "black"),
        ]

        function newStillEnemy(x, y, sx, sy, sp, sk) {
            return {x:x, y:y, sx:sx, sy:sy, sp:sp, sk:sk}
        }

        let materialQuest = [
            newMaterial (600, 750, 50, 50, "brown", "wood", false),
        ]

        function newMaterial(x, y, sx, sy, sk, name) {
            return {x:x, y:y, sx:sx, sy:sy, sk:sk, name:name}
        }

      function onKey(event) {
            if (event.keyCode == 65 || event.keyCode == 37) {
                speedX = -8;
            }
            if (event.keyCode == 68 || event.keyCode == 39) {
                speedX = 8;
            }
			if (event.keyCode == 87 || event.keyCode == 38) {
               speedY = -8;
			}
			if (event.keyCode == 83 || event.keyCode == 40) {
              speedY = 8;
			}

            if (event.code == "KeyE") {
                E = true;
            }

            if (event.code == "KeyQ") {
                Q = true;
            }

        }

        function onKeyUp() {
                if (event.code == "KeyW" || event.code == "KeyS" || event.code == "ArrowUp" || event.code == "ArrowDown" ) {
                    speedY = 0;
                }
                if ( event.code == "KeyA" || event.code == "KeyD"||  event.code == "ArrowLeft" || event.code == "ArrowRight") {
                    speedX = 0;
                }

                if (event.code == "KeyE") {
                    E = false;
                    EPush = false;
                }

                if (event.code == "KeyQ") {
                    Q = false;
                    QPush = false;
                }
            }

    function draw() {
        ctx.clearRect(0, 0, canvas.clientWidth, canvas.clientHeight);

        enemyMovement();
        stillEnemyMovement();
        CooperatingWithNPC();
        InventoryControl();
        Controls();

        posX += speedX;
        posY += speedY;

        ctx.fillStyle = "blue";
        ctx.fillRect(posX, posY, plSizeX, plSizeY);

        ctx.fillStyle = npc.sk;
        ctx.fillRect(npc.x, npc.y, npc.sx, npc.sy);

        if (posY <= 0){
			    posY += 8;
			}
			if (posY + plSizeY >= canvas.height) {
			    posY -= 8;
			}
			if (posX <= 0) {
			    posX += 8;
			}
			if (posX + plSizeX >= canvas.width) {
			    posX -= 8;
			}

        for (stillEnemy of stillEnemyList) {
            ctx.fillStyle = stillEnemy.sk;
            ctx.fillRect(stillEnemy.x, stillEnemy.y, stillEnemy.sx, stillEnemy.sy);
        }
        for (enemy of enemyList) {
            ctx.fillStyle = enemy.sk;
            ctx.fillRect(enemy.x, enemy.y, enemy.szX, enemy.szY);
        }

        for (material of materialQuest) {
            ctx.fillStyle = material.sk;
            ctx.fillRect(material.x, material.y, material.sx, material.sy);
        }
    }

    function CooperatingWithNPC() {
        if (talk == 1) { text("28px Lucida sans", "Black", "center", npc.x, npc.y - 25, "-- Hi, My name is Lucio, but you know that already.")  }
        if (talk == 2) { text("28px Lucida sans", "Black", "center", npc.x, npc.y - 25, "-- Our car has unfortunatly crashed here.")  }
        if (talk == 3) { text("28px Lucida sans", "Black", "center", npc.x, npc.y - 25, "-- So now, we need to get some wood for repair.")  }
        if (talk == 4) { text("28px Lucida sans", "Black", "center", npc.x, npc.y - 25, "-- You go get it and I'll be here and watch the car.")  }
        if (talk == 5) { text("28px Lucida sans", "Black", "center", npc.x, npc.y - 25, "-- When you'll find it, bring it here to me, Good Luck.")}
        if (talk == 6) { text("28px Lucida sans", "Black", "center", npc.x, npc.y - 25, ""); npcStatus = 1}

        if (talk <= 5 && E == true && EPush == false && collision(posX, npc.x, plSizeX, npc.sx, 0) && collision(posY, npc.y, plSizeY, npc.sy, 0)) {
            talk++ ;
            EPush = true;
        }

        if (E == true && npcStatus == 1) {
            if (collision(posX, npc.x, plSizeX, npc.sx, 0) && collision(posY, npc.y, plSizeY, npc.sy, 0)) {
                MaterialInInventory = false;
                npcStatus = 2;
            }
        }
    }

    function InventoryControl() {
        if (MaterialInInventory == true) {
            inventoryElement.innerHTML = "Wood";
        }

        if (MaterialInInventory == false) {
            inventoryElement.innerHTML = "  You have empty bag."
        }

        if (E == true && talk == 6) {
                for (material of materialQuest) {
                   if (collision(posX, material.x, plSizeX, material.sx, 0) && collision(posY, material.y, plSizeY, material.sy, 0)) {
                        materialQuest.shift();
                        MaterialInInventory = true;
                 }
             }
        }
    }

    function Controls() {
        if (Q == true) {
            text("30px Lucida sans", "Black", "left", 20, 25, "Controls:");
            text("25px Lucida sans", "Black", "left", 20, 50, "Movement - WASD");
            text("25px Lucida sans", "Black", "left", 20, 78, "To Interaction press 'E'");
        }
    }

    function text(font, cl, align, x, y, text) {
        ctx.font = font;
        ctx.fillStyle = cl;
        ctx.textAlign = align;
        ctx.fillText(text, x, y);
    }

    function collision(obj1, obj2, sz1, sz2, dis) {
            let midd1 = obj1 + sz1 / 2;
			let midd2 = obj2 + sz2 / 2;
			let min = (sz1 + sz2 + dis) / 2;
			let diff = Math.abs (midd1 - midd2);
			return diff < min;
    }

    function enemyMovement() {
        for (enemy of enemyList) {
            if (!enemy.fr) {
            enemy.x += Math.cos(enemy.ang) * enemy.sp;
            enemy.y += Math.sin(enemy.ang) * enemy.sp;

            if (Math.random() < 0.05) enemy.ang = Math.random() * Math.PI * 2;

            if (enemy.x <= 0) enemy.ang = Math.PI - enemy.ang;
            if (enemy.x + enemy.szX >= canvas.width) enemy.ang = Math.PI - enemy.ang;

            if (enemy.y <= 350) enemy.ang = -enemy.ang;
            if (enemy.y + enemy.szY >= canvas.height) enemy.ang = -enemy.ang;

         }
      }
    }

    function stillEnemyMovement() {
        for (stillEnemy of stillEnemyList) {
            stillEnemy.x += stillEnemy.sp;
            if (stillEnemy.x >= canvas.width) stillEnemy.x = 0;
        }
    }
    setInterval(draw, 15);
</script>
</html>
